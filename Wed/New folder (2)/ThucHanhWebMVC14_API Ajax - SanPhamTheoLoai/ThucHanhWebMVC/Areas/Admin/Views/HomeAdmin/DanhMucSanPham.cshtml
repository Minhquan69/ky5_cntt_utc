@using ThucHanhWebMVC.Models;
@using X.PagedList.Mvc.Core;
@model X.PagedList.IPagedList<TDanhMucSp>
@{
    ViewData["Title"] = "DanhMucSanPham";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h3>Danh mục các sản phẩm</h3>
<body onload="HideDiv()">
    <p>
        <a asp-action="ThemSanPhamMoi">Create New</a>
    </p>
    @* Thêm sản phẩm bằng API *@
    <a onclick="showHideDiveInsertData('displayForm'); return false;" class="btn btn-primary">Thêm sản phẩm bằng API</a>

    <div id="displayForm">
        <form id="formAddProduct" method="post">
            <div class="form-group">
                <label class="control-label">Mã sản phẩm</label>
                <input type="text" class="form-control" id="MaSp" />
            </div>
            <div class="form-group">
                <label class="control-label">Tên sản phẩm</label>
                <input type="text" class="form-control" id="TenSp" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã chất liệu</label>
                <input type="text" class="form-control" id="MaChatLieu" />
            </div>
            <div class="form-group">
                <label class="control-label">Ngăn laptop</label>
                <input type="text" class="form-control" id="NganLapTop" />
            </div>
            <div class="form-group">
                <label class="control-label">Model</label>
                <input type="text" class="form-control" id="Model" />
            </div>
            <div class="form-group">
                <label class="control-label">Cân nặng</label>
                <input id="CanNang" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Độ nới</label>
                <input id="DoNoi" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã hãng sản xuất</label>
                <input id="MaHangSx" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã nước sản xuất</label>
                <input id="MaNuocSx" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã đặc tính</label>
                <input id="MaDacTinh" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Website</label>
                <input id="Website" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Thời gian bảo hành</label>
                <input id="ThoiGianBaoHanh" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Giới thiệu sản phẩm</label>
                <input id="GioiThieuSp" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Chiết khấu</label>
                <input id="ChietKhau" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã loại</label>
                <input id="MaLoai" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Mã đối tượng</label>
                <input id="MaDoiTuong" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Ảnh đại diện</label>
                <input id="AnhDaiDien" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Giá nhỏ nhất</label>
                <input id="GiaNhoNhat" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <label class="control-label">Giá lớn nhất</label>
                <input id="GiaLonNhat" type="text" class="form-control" />
            </div>
            <div class="form-group">
                <input onclick="addANewProduct('https://localhost:7221/api/Product/'); return false;" value="Thêm sản phẩm" class="btn btn-primary" />
            </div>
        </form>
    </div>
    <div id="displayEditForm"></div>
</body>

<script type="text/javascript">
    function HideDiv() {
        $(document.getElementById(activeDiv)).hide();
    }

    function addANewProduct(apiUrl) {
        var duLieuSanPham = {
            maSp: $('#MaSp').val(),
            tenSp: $('#TenSp').val(),
            maChatLieu: $('#MaChatLieu').val(),
            nganLapTop: $('#NganLapTop').val(),
            model: $('#Model').val(),
            canNang: parseFloat($('#CanNang').val()),
            doNoi: parseFloat($('#DoNoi').val()),
            maHangSx: $('#MaHangSx').val(),
            maNuocSx: $('#MaNuocSx').val(),
            maDacTinh: $('#MaDacTinh').val(),
            website: $('#Website').val(),
            thoiGianBaoHanh: parseFloat($('#ThoiGianBaoHanh').val()),
            gioiThieuSp: $('#GioiThieuSp').val(),
            chietKhau: parseFloat($('#ChietKhau').val()),
            maLoai: $('#MaLoai').val(),
            maDt: $('#MaDt').val(),
            anhDaiDien: $('#AnhDaiDien').val(),
            giaNhoNhat: parseFloat($('#GiaNhoNhat').val()),
            giaLonNhat: parseFloat($('#GiaLonNhat').val())
        };

        $.ajax({
            type: 'POST',
            url: apiUrl,
            data: JSON.stringify(duLieuSanPham),
            contentType: 'application/json',
            dataType: 'json',
            success: function (data) {
                alert('Thêm sản phẩm thành công!');
                window.location.href = 'https://localhost:7044/admin/homeadmin/danhmucsanpham';
            },
            error: function (loi) {
                console.error('Lỗi khi thêm sản phẩm:', loi);
                alert(JSON.stringify(duLieuSanPham));
            }
        });
    }

    function showHideDiveInsertData(activeDiv) {
        if ($(document.getElementById(activeDiv)).is(":visible")) {
            $(document.getElementById(activeDiv)).hide('slow');
        } else {
            $(document.getElementById(activeDiv)).show('slow');
        }
    }
</script>
